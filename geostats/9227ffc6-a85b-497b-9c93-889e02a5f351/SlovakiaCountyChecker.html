

<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Slovakia Counties</title>
    <link rel="manifest" href="manifest.json" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="GeoStats" />
    <meta name="apple-mobile-web-app-title" content="GeoStats" />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <link rel="apple-touch-icon" sizes="120x120" href="/geostats-static/icons/globe-120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/geostats-static/icons/globe-152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/geostats-static/icons/globe-167.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/geostats-static/icons/globe-180.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/geostats-static/icons/globe-192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="/geostats-static/icons/globe-512.png">
    <link rel="apple-touch-icon" sizes="1024x1024" href="/geostats-static/icons/globe-1024.png">
    <link rel="apple-touch-icon" sizes="1920x1920" href="/geostats-static/icons/globe-1920.png">
    <link rel="icon" href="/geostats-static/icons/globe-120.png">
    <link rel="shortcut icon" href="/geostats-static/favicon.ico" type="image/vnd.microsoft.icon">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.4/css/bulma.min.css">
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/bulma-prefers-dark" />

    <script src="index.js"></script>
    <script src="searchBuilder.js"></script>
    <link rel="stylesheet" type="text/css" href="index.css">

    
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin="" />
<!-- Leaflet JavaScript -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>
<style>
    #map {
        height: 600px;
        width: 100%;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    .county-info {
        padding: 6px 8px;
        font: 14px/16px Arial, Helvetica, sans-serif;
        background: white;
        background: rgba(255, 255, 255, 0.8);
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        border-radius: 5px;
    }

    .county-info h4 {
        margin: 0 0 5px;
        color: #777;
    }

    .county-search-icon {
        /* Leaflet DivIcon container for the centered search overlay */
        background: #000; /* opaque */
        color: #fff;
        padding: 6px 8px;
        border-radius: 6px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        font-size: 14px;
        font-family: Arial, Helvetica, sans-serif;
        line-height: 1;
        cursor: pointer;
        /* Center the bubble over the marker's LatLng */
        transform: translate(-50%, -50%);
        white-space: nowrap;
        user-select: none;
    }

    .county-search-icon i {
        margin-right: 8px;
    }

    /* Ensure default Leaflet div icon container has no extra chrome */
    .leaflet-div-icon {
        background: transparent;
        border: none;
    }
</style>

</head>

<body>
    <nav class="navbar is-spaced has-shadow" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
          <a class="navbar-item" href="./index.html">
            <i class="fa fa-globe fa-xl"></i>
          </a>

          <a class="navbar-item "  href="./not-passing.html">
            <i class="fa fa-times fa-xl"></i>
          </a>

          <a class="navbar-item " href="./passing.html">
            <i class="fa fa-check fa-xl"></i>
          </a>

          <a class="navbar-item " style="background-color: #f14668;" href="./info.html">
            <i class="fa fa-info fa-xl"></i>
          </a>
        </div>
    </nav>

    <section class="section">
    <div class="container">
        <div class="columns">
            <div class="column">
                <div class="box">
                    <div id="map"></div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    // Initialize the map centered on Slovakia
    var map = L.map('map').setView([48.7, 19.5], 7);
    var counts = {};

    counts["Rožňava"] = 3;
    counts["Ružomberok"] = 4;
    counts["Tvrdošín"] = 7;
    counts["Šaľa"] = 72;
    counts["Košice II"] = 1;
    counts["Nové Mesto nad Váhom"] = 15;
    counts["Banská Bystrica"] = 13;
    counts["Košice IV"] = 1;
    counts["Poltár"] = 1;
    counts["Galanta"] = 150;
    counts["Liptovský Mikuláš"] = 19;
    counts["Vranov nad Topľou"] = 1;
    counts["Stropkov"] = 2;
    counts["Hlohovec"] = 18;
    counts["Poprad"] = 47;
    counts["Humenné"] = 2;
    counts["Nitra"] = 94;
    counts["Spišská Nová Ves"] = 19;
    counts["Košice I"] = 1;
    counts["Kysucké Nové Mesto"] = 1;
    counts["Levice"] = 12;
    counts["Svidník"] = 1;
    counts["Krupina"] = 1;
    counts["Senec"] = 188;
    counts["Bratislava IV"] = 842;
    counts["Bardejov"] = 3;
    counts["Ilava"] = 9;
    counts["Trenčín"] = 9;
    counts["Sobrance"] = 1;
    counts["Kežmarok"] = 4;
    counts["Rimavská Sobota"] = 1;
    counts["Stará Ľubovňa"] = 1;
    counts["Banská Štiavnica"] = 1;
    counts["Čadca"] = 8;
    counts["Bratislava III"] = 631;
    counts["Veľký Krtíš"] = 1;
    counts["Malacky"] = 364;
    counts["Senica"] = 44;
    counts["Brezno"] = 10;
    counts["Bánovce nad Bebravou"] = 1;
    counts["Námestovo"] = 5;
    counts["Detva"] = 8;
    counts["Žiar nad Hronom"] = 21;
    counts["Žarnovica"] = 70;
    counts["Košice III"] = 1;
    counts["Partizánske"] = 4;
    counts["Sabinov"] = 13;
    counts["Skalica"] = 80;
    counts["Púchov"] = 16;
    counts["Revúca"] = 1;
    counts["Snina"] = 6;
    counts["Medzilaborce"] = 1;
    counts["Bytča"] = 12;
    counts["Bratislava I"] = 343;
    counts["Myjava"] = 7;
    counts["Topoľčany"] = 15;
    counts["Zlaté Moravce"] = 58;
    counts["Dunajská Streda"] = 103;
    counts["Prešov"] = 5;
    counts["Prievidza"] = 26;
    counts["Žilina"] = 26;
    counts["Gelnica"] = 1;
    counts["Komárno"] = 8;
    counts["Michalovce"] = 1;
    counts["Zvolen"] = 8;
    counts["Trebišov"] = 1;
    counts["Košice - okolie"] = 33;
    counts["Martin"] = 10;
    counts["Piešťany"] = 65;
    counts["Trnava"] = 156;
    counts["Bratislava II"] = 378;
    counts["Považská Bystrica"] = 7;
    counts["Levoča"] = 4;
    counts["Nové Zámky"] = 13;
    counts["Pezinok"] = 258;
    counts["Lučenec"] = 1;
    counts["Bratislava V"] = 612;
    counts["Dolný Kubín"] = 26;
    counts["Turčianske Teplice"] = 2;

    var cacherName = "zemiak";

    // Add OpenStreetMap tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Info control
    var info = L.control();

    info.onAdd = function (map) {
        this._div = L.DomUtil.create('div', 'county-info');
        this.update();
        return this._div;
    };

    info.update = function (props) {
        var countyName = props && props.NM3 ? props.NM3 : null;
        var cacheCount = counts[countyName] ? counts[countyName] : 0;

        this._div.innerHTML = '<h4>SK Counties</h4>' +
            (props ? '<b>' + countyName + '</b><br />' +
                'Caches: ' + cacheCount + '<br />'
                : 'Hover over a district');
    };

    info.addTo(map);

    // Style function for the GeoJSON layer
    function style(feature) {
        return {
            fillColor: getColor(feature.properties.NM3),
            weight: 2,
            opacity: 1,
            color: 'white',
            dashArray: '3',
            fillOpacity: 0.7
        };
    }

    // Color based on area size
    function getColor(countyName) {
        var cacheCount = counts[countyName] ? counts[countyName] : 0;

        if (cacheCount == null || cacheCount == 0) {
            return "#ff0000";
        }

        if (cacheCount < 11) {
            return "#b8c694";
        }

        if (cacheCount < 26) {
            return "#8c9e65";
        }

        if (cacheCount < 100) {
            return "#697d3e";
        }

        if (cacheCount < 251) {
            return "#495829";
        }

        return "#36411e";
    }

    // Highlight feature on mouse over
    function highlightFeature(e) {
        var layer = e.target;

        layer.setStyle({
            weight: 5,
            color: 'white',
            dashArray: '',
            fillOpacity: 0.7
        });

        if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
            layer.bringToFront();
        }

    info.update(layer.feature.properties);
    }

    // Reset highlight when mouse leaves
    function resetHighlight(e) {
        geojsonLayer.resetStyle(e.target);
        info.update();
    }

    // Zoom to feature on click
    function zoomToFeature(e) {
        map.fitBounds(e.target.getBounds());
    }

    // Bind events to each feature
    function onEachFeature(feature, layer) {
        layer.on({
            mouseover: highlightFeature,
            mouseout: resetHighlight,
            click: zoomToFeature
        });
    }

    // Layer group to hold all county search markers (always visible)
    var countySearchMarkers = L.layerGroup().addTo(map);

    function searchCounty(countyName) {
        var builder = new SearchBuilder();
        var url = builder.county("Slovakia", countyName).cacherName(cacherName).build();

        var win = window.open(url, '_blank');
        if (win) {
            win.opener = null;
            win.focus();
        }
    }

    // Variable to hold the GeoJSON layer
    var geojsonLayer;

    // Fetch and add the GeoJSON data
    fetch('districts_epsg_4326.geojson')
        .then(response => response.json())
        .then(data => {
            geojsonLayer = L.geoJSON(data, {
                style: style,
                onEachFeature: onEachFeature
            }).addTo(map);

            // Fit map to GeoJSON bounds
            map.fitBounds(geojsonLayer.getBounds());

            // Create a fixed, always-visible search icon for every county
            geojsonLayer.eachLayer(function (layer) {
                if (!layer.feature || !layer.feature.properties) return;
                var countyName = layer.feature.properties.NM3;
                if (!countyName) return;

                // Center point of the county (using bounds center as an approximation)
                var center = layer.getBounds().getCenter();
                var html = '<i class="fa fa-search"></i>';

                var marker = L.marker(center, {
                    icon: L.divIcon({
                        className: 'county-search-icon',
                        html: html,
                        iconSize: null
                    }),
                    interactive: true
                });

                marker.on('click', function () {
                    searchCounty(countyName);
                });

                countySearchMarkers.addLayer(marker);
            });
        })
        .catch(error => {
            console.error('Error loading GeoJSON:', error);
            alert('Error loading county data. Please ensure the districts_epsg_4326.geojson file is available.');
        });
</script>


    <div class="modal" id="cache-list">
        <div class="modal-background"></div>
        <div class="modal-content" id="cache-list-modal-box-content">
            <p>Loading...</p>
        </div>
        <button class="modal-close is-large" aria-label="close"></button>
    </div>
  </body>
</html>
