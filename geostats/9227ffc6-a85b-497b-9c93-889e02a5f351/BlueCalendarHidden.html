<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Mystery (Hidden)</title>
    <link rel="manifest" href="manifest.json" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="GeoStats" />
    <meta name="apple-mobile-web-app-title" content="GeoStats" />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" sizes="120x120" href="/geostats-static/icons/globe-120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/geostats-static/icons/globe-152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/geostats-static/icons/globe-167.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/geostats-static/icons/globe-180.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/geostats-static/icons/globe-192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="/geostats-static/icons/globe-512.png">
    <link rel="apple-touch-icon" sizes="1024x1024" href="/geostats-static/icons/globe-1024.png">
    <link rel="apple-touch-icon" sizes="1920x1920" href="/geostats-static/icons/globe-1920.png">
    <link rel="icon" href="/geostats-static/icons/globe-120.png">
    <link rel="shortcut icon" href="/geostats-static/favicon.ico" type="image/vnd.microsoft.icon">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.4/css/bulma.min.css">
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/bulma-prefers-dark" />

    <script src="index.js"></script>
    
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/js-year-calendar@latest/dist/js-year-calendar.min.css" />
    <script src="https://unpkg.com/js-year-calendar@latest/dist/js-year-calendar.min.js"></script>

</head>

<body>
    <nav class="navbar is-spaced has-shadow" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
          <a class="navbar-item" href="./index.html">
            <i class="fa fa-globe fa-xl"></i>
          </a>

          <a class="navbar-item" href="./not-passing.html">
            <i class="fa fa-times fa-xl"></i>
          </a>

          <a class="navbar-item" href="./passing.html">
            <i class="fa fa-check fa-xl"></i>
          </a>

          <a class="navbar-item" href="./info.html">
            <i class="fa fa-info fa-xl"></i>
          </a>
        </div>
    </nav>

        <center><h1>Mystery (Hidden)</h1></center>

    <div id="desktop-calendar">
    </div>

    <div class="modal" id="cache-list">
        <div class="modal-background"></div>
        <div class="modal-content">
            <div class="box">
                <div class="content" id="cache-list-modal-box-content">
                    <p>Loading...</p>
                </div>
            </div>
        </div>
        <button class="modal-close is-large" aria-label="close"></button>
    </div>


    <div id="data-slices" style="display: none;">
        [
                    {
                        "startDate": "2023-03-05",
                        "endDate": "2023-03-05",
                        "searchUrl": "https://www.geocaching.com/play/results?r=10&oid=-1&ot=home&hf=1&ho=1&nfb=zemiak&ct=8&pod=2022-03-05",
                        "searchKey": "search_03_05"
                    },
                    {
                        "startDate": "2023-04-03",
                        "endDate": "2023-04-03",
                        "searchUrl": "https://www.geocaching.com/play/results?r=10&oid=-1&ot=home&hf=1&ho=1&nfb=zemiak&ct=8&pod=2022-04-03",
                        "searchKey": "search_04_03"
                    },
                    {
                        "startDate": "2023-06-22",
                        "endDate": "2023-06-22",
                        "searchUrl": "https://www.geocaching.com/play/results?r=10&oid=-1&ot=home&hf=1&ho=1&nfb=zemiak&ct=8&pod=2022-06-22",
                        "searchKey": "search_06_22"
                    },
                    {
                        "startDate": "2023-07-19",
                        "endDate": "2023-07-19",
                        "searchUrl": "https://www.geocaching.com/play/results?r=10&oid=-1&ot=home&hf=1&ho=1&nfb=zemiak&ct=8&pod=2022-07-19",
                        "searchKey": "search_07_19"
                    },
                    {
                        "startDate": "2023-08-06",
                        "endDate": "2023-08-06",
                        "searchUrl": "https://www.geocaching.com/play/results?r=10&oid=-1&ot=home&hf=1&ho=1&nfb=zemiak&ct=8&pod=2022-08-06",
                        "searchKey": "search_08_06"
                    },
                    {
                        "startDate": "2023-08-30",
                        "endDate": "2023-08-30",
                        "searchUrl": "https://www.geocaching.com/play/results?r=10&oid=-1&ot=home&hf=1&ho=1&nfb=zemiak&ct=8&pod=2022-08-30",
                        "searchKey": "search_08_30"
                    },
                    {
                        "startDate": "2023-12-08",
                        "endDate": "2023-12-08",
                        "searchUrl": "https://www.geocaching.com/play/results?r=10&oid=-1&ot=home&hf=1&ho=1&nfb=zemiak&ct=8&pod=2022-12-08",
                        "searchKey": "search_12_08"
                    },
        {"startDate": "1970-01-01", "endDate": "1970-01-01", "searchUrl": "nope", "searchKey": "nope"}
        ]
    </div>

    <script>
        let year = 2023;
        const jsonText = document.getElementById("data-slices").innerHTML;
        const dataSlices = JSON.parse(jsonText);

        let searchUrls = {};
        let dataSlicesParsed = [];
        for (let i = 0; i < dataSlices.length; i++) {
            let dataSlice = dataSlices[i];
            let startDate = new Date(dataSlice.startDate);
            let endDate = new Date(dataSlice.endDate);
            dataSlicesParsed.push({
                startDate: startDate,
                endDate: endDate
            });

            searchUrls[dataSlice.searchKey] = dataSlice.searchUrl.replaceAll("&amp;", "&");
        }

        let beginningOfTheYear = new Date(year, 0, 1);
        let endOfTheYear = new Date(year, 11, 31);
        new Calendar("#desktop-calendar", {
            minDate: beginningOfTheYear,
            maxDate: endOfTheYear,
            dataSource: dataSlicesParsed,
            weekStart: 1
        });

        document.querySelector('#desktop-calendar').addEventListener('clickDay', function(e) {
            const id = e.date.getMonth() + 1 + "-" + e.date.getDate();
            const searchId = "search_" + String(e.date.getMonth() + 1).padStart(2, "0") + "_" + String(e.date.getDate()).padStart(2, "0");
            const site = id + ".html";
            const url = window.location.href;
            const index = url.lastIndexOf("/");
            const path = url.substring(0, index);
            const documentUrl = path + "/BlueCalendarHidden/" + site;

            const $modalTarget = document.getElementById("cache-list");
            const $modalContentTarget = document.getElementById("cache-list-modal-box-content");

            if (searchUrls.hasOwnProperty(searchId)) {
                console.log("Opening " + searchUrls[searchId]);
                window.open(searchUrls[searchId], "_blank");
            } else {
                fetch(documentUrl).then((response) => {
                response.text().then((text) => {
                    $modalContentTarget.innerHTML = text;
                    $modalTarget.classList.add("is-active");
                });
            });
            }
        })
    </script>

  </body>
</html>
